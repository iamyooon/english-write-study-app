/**
 * Next.js 설정 파일
 * 
 * 사용법:
 * 1. 이 파일을 next.config.js로 복사
 * 2. next-pwa 설치: npm install next-pwa
 * 3. 환경에 맞게 설정 수정
 */

const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development', // 개발 환경에서는 PWA 비활성화
  runtimeCaching: [
    {
      urlPattern: /^https:\/\/.*\.supabase\.co\/.*/i,
      handler: 'NetworkFirst',
      options: {
        cacheName: 'supabase-cache',
        expiration: {
          maxEntries: 50,
          maxAgeSeconds: 60 * 60 * 24, // 24시간
        },
      },
    },
  ],
})

/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  
  // 이미지 도메인 설정 (Supabase 스토리지)
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '*.supabase.co',
        pathname: '/storage/v1/object/public/**',
      },
    ],
  },
  
  // 환경 변수 설정
  env: {
    NEXT_PUBLIC_APP_URL: process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000',
  },
  
  // 실험적 기능
  experimental: {
    // 서버 액션 사용 (API Routes 대신)
    serverActions: true,
  },
}

module.exports = withPWA(nextConfig)
