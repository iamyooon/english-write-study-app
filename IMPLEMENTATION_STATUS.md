# 구현 상태 체크리스트 (03_design.md 기준)

## ✅ 구현 완료된 기능

### 1. 기본 인프라
- ✅ Next.js 14+ (App Router) 설정
- ✅ Supabase 연동 (클라이언트/서버 유틸리티)
- ✅ OpenAI API 연동 (GPT-4o)
- ✅ 온보딩 플로우 (Guest Mode + 학년 선택)
- ✅ Placement Test 시스템 (`/api/placement/submit`)
- ✅ 기본 미션 생성 (`/api/study/generate-mission`)
- ✅ Drag & Drop 미션 생성 (`/api/study/generate-drag-drop-mission`) - 레벨 1-2
- ✅ Writing 제출 및 AI 피드백 (`/api/study/submit`)
- ✅ Drag & Drop 제출 (`/api/study/drag-drop-submit`)
- ✅ 3중 안전 필터링 (클라이언트 금칙어 + OpenAI Moderation)
- ✅ 힌트 시스템 (정답/오답 모두 힌트 제공)
- ✅ 자동 다음 문장 생성 (정답 시)
- ✅ 에너지 시스템 (학습 시 감소, 미션 생성 1 에너지 소모)
- ✅ `next-pwa` 패키지 설치 (설정 미완료)

### 2. 데이터베이스
- ✅ `profiles` 테이블 (기본 구조)
- ✅ `study_logs` 테이블 (기본 구조)
- ✅ `shop_items`, `user_inventory` 테이블
- ✅ RLS 정책 적용

---

## ❌ 미구현 기능 (우선순위별)

### 🔴 Phase 1: 핵심 기능 (즉시 구현 필요)

#### 1. Placement Test 시스템
**설계 요구사항:**
- 온보딩 후 즉시 실행 (Guest Mode 포함)
- 5~7문항 처리
- GPT-4o로 점수 평가 (프롬프트: "초등 수준 정확도·완성도·시간 평가")
- 결과 저장: `profiles.placement_level` 업데이트
- UI: 진행바 + 격려 문구 + 결과 애니메이션

**구현 완료:**
- ✅ `app/api/placement/submit/route.ts` 생성
- ✅ `app/placement/page.tsx` 생성 (Placement Test UI)
- ✅ 온보딩 플로우에 Placement Test 단계 추가
- ✅ `profiles` 테이블에 `placement_level` 컬럼 추가
- ✅ 기존 레벨이 있으면 자동 스킵 로직
- ✅ 재시도 옵션 제공 (`?retake=true`)

**현재 상태:** ✅ 구현 완료

---

#### 2. 에너지 시스템
**설계 요구사항:**
- 매일 100 충전 (자정 기준)
- 미션 1회당 100 소비
- 작성 문장당 +10 생산
- 부족 시 카운트다운 UI
- 시각화: 홈 화면 에너지 게이지

**구현 완료:**
- ✅ 미션 생성 시 에너지 소비 (1 에너지)
- ✅ 에너지 부족 시 에러 메시지 표시
- ✅ 헤더에 에너지 표시 (실시간 업데이트)

**필요 작업:**
- [ ] `profiles` 테이블에 `energy_last_charged` 컬럼 추가
- [ ] 자정 에너지 자동 충전 로직 (Cron Job 또는 Supabase Edge Function)
- [ ] 작성 문장당 에너지 생산 로직 (현재는 감소만)
- [ ] 에너지 부족 시 카운트다운 UI
- [ ] 홈 화면 에너지 게이지 컴포넌트

**현재 상태:** ⚠️ 부분 구현 (미션 생성 시 소비만 구현, 자동 충전/생산 로직 없음)

---

#### 3. 기본 미션 흐름 완성
**설계 요구사항:**
- 순서: 미션 제시 → **어휘 노출** → **예시** → 작성 → LLM 피드백 → 보상
- 피드백: Level 1에 한정 (긍정 중심 프롬프트)
- Free 제한: 피드백 3회 → 초과 시 queued 상태로 study_logs 저장

**구현 완료:**
- ✅ Drag & Drop 미션 (레벨 1-2): 클릭 기반 단어 선택
- ✅ 키보드 입력 미션 (레벨 3-6): 기존 방식 유지
- ✅ 힌트 시스템: 정답/오답 모두 힌트 제공
- ✅ 자동 다음 문장 생성: 정답 시 2초 후 자동 진행
- ✅ 피드백 UI: 평가 결과, 점수, 힌트 표시

**필요 작업:**
- [ ] 어휘 노출 UI (미션 생성 시 어휘 목록 표시)
- [ ] 예시 문장 표시 UI
- [ ] Level 1 피드백 프롬프트 개선 (긍정 중심)
- [ ] Free 제한 로직 수정 (현재 5회 → 3회로 변경)
- [ ] Queue 상태 처리 로직 개선

**현재 상태:** ⚠️ 부분 구현 (기본 흐름 + 힌트 시스템 완료, 어휘/예시 노출 없음)

---

#### 4. "다시 써볼래?" 기능
**설계 요구사항:**
- 피드백 후 버튼 노출 (`retry_count ≤ 3`)
- 3회 초과 시 다음 날 알림 예약 (FCM)

**필요 작업:**
- [ ] `study_logs` 테이블에 `retry_count` 컬럼 추가 (스키마 업데이트 필요)
- [ ] Writing 페이지에 "다시 써볼래?" 버튼 추가
- [ ] 재시도 로직 구현 (같은 미션으로 재제출)
- [ ] 3회 초과 시 FCM 알림 예약 (FCM 연동 후)

**현재 상태:** ❌ 미구현

---

### 🟡 Phase 2: 게이미피케이션 및 UX

#### 5. Word Planet 탐험대 캐릭터
**설계 요구사항:**
- 기본 1종 (탐험가 모자 쓴 작은 행성)
- 성장: 미션 완료 시 모자에 별 추가 (시각적 변화 3단계)

**필요 작업:**
- [ ] 캐릭터 컴포넌트 디자인 및 구현
- [ ] 캐릭터 성장 로직 (미션 완료 시 별 추가)
- [ ] 3단계 시각적 변화 애니메이션
- [ ] 홈 화면에 캐릭터 표시

**현재 상태:** ❌ 미구현

---

#### 6. 에너지 게이지 UI
**설계 요구사항:**
- 홈 화면 에너지 게이지
- 키즈 앱 스타일 (반짝이 + 별 요소 포함)
- 에너지 부족 시 카운트다운 표시

**필요 작업:**
- [ ] 에너지 게이지 컴포넌트 생성
- [ ] 홈 화면 (`app/page.tsx`)에 게이지 추가
- [ ] 카운트다운 UI (다음 충전까지 남은 시간)

**현재 상태:** ❌ 미구현

---

### 🟢 Phase 3: 확장 기능

#### 7. Free 버전 제한 로직 완성
**설계 요구사항:**
- 에너지: 하루 1회 충전 (100)
- 피드백: 세션당 3회 (현재 5회로 설정됨)
- 힌트: 1회

**필요 작업:**
- [ ] 피드백 제한 수정 (5회 → 3회)
- [ ] 힌트 시스템 구현 (1회 제한)
- [ ] 세션당 제한 로직 (현재 일일 제한만 있음)

**현재 상태:** ⚠️ 부분 구현 (일일 제한만 있음, 세션당 제한 없음)

---

#### 8. 기본 학부모 리포트
**설계 요구사항:**
- 접근: 별도 PIN 모드
- 내용: 주간 문장 수 / 자주 쓰는 단어 TOP5 / 간단 메시지
- Realtime: 미션 완료 시 부모 기기로 FCM 알림

**필요 작업:**
- [ ] `app/api/parents/report/route.ts` 생성
- [ ] `app/api/parents/push-token/route.ts` 생성
- [ ] `app/parents/page.tsx` 생성 (PIN 모드)
- [ ] 주간 통계 쿼리 (문장 수, 자주 쓰는 단어)
- [ ] FCM 연동 (미션 완료 시 알림)

**현재 상태:** ❌ 미구현

---

#### 9. FCM (Firebase Cloud Messaging) 연동
**설계 요구사항:**
- 부모 푸시 알림 전용
- 미션 완료 시 부모 기기로 알림
- 부적절한 내용 감지 시 부모 알림

**필요 작업:**
- [ ] Firebase 프로젝트 설정
- [ ] FCM 토큰 등록 API (`/api/parents/push-token`)
- [ ] 미션 완료 시 알림 전송 로직
- [ ] 부적절한 내용 감지 시 알림 전송 로직

**현재 상태:** ❌ 미구현 (TODO 주석만 있음)

---

#### 10. RevenueCat 연동
**설계 요구사항:**
- IAP 영수증 검증 로직 자동화
- Premium 전환 시 `profiles.is_premium = true` 업데이트

**필요 작업:**
- [ ] RevenueCat SDK 설정
- [ ] 결제 검증 API 생성
- [ ] Premium 전환 로직
- [ ] 결제 UI 구현

**현재 상태:** ❌ 미구현 (패키지 설치만 됨)

---

#### 11. PWA 설정 완료
**설계 요구사항:**
- 홈 화면 추가
- 오프라인 지원 (캐시된 미션 프롬프트 활용 가능)

**필요 작업:**
- [ ] `next.config.js`에 `next-pwa` 설정 추가 (현재 주석 처리됨)
- [ ] PWA 매니페스트 파일 생성
- [ ] 오프라인 캐싱 전략 설정
- [ ] 서비스 워커 등록

**현재 상태:** ⚠️ 부분 구현 (패키지 설치만 됨, 설정 미완료)

---

## 📊 데이터베이스 스키마 업데이트 필요

### `profiles` 테이블
```sql
ALTER TABLE profiles
ADD COLUMN placement_level int DEFAULT 1,
ADD COLUMN energy_last_charged timestamp with time zone DEFAULT now();
```

### `study_logs` 테이블
```sql
ALTER TABLE study_logs
ADD COLUMN energy_gained int DEFAULT 0,
ADD COLUMN retry_count int DEFAULT 0;
```

---

## 🎯 우선순위별 구현 계획

### Week 1 (핵심 기능)
1. Placement Test 시스템
2. 에너지 시스템 완성 (자동 충전/소비)
3. 기본 미션 흐름 완성 (어휘/예시 노출)
4. "다시 써볼래?" 기능

### Week 2 (게이미피케이션)
5. Word Planet 캐릭터
6. 에너지 게이지 UI
7. Free 버전 제한 로직 완성

### Week 3 (확장 기능)
8. 기본 학부모 리포트
9. FCM 연동
10. RevenueCat 연동
11. PWA 설정 완료

---

## 📝 참고사항

- 현재 구현된 기능들은 기본적인 MVP 기능만 포함
- `03_design.md`의 모든 기능을 구현하려면 위의 미구현 항목들을 순차적으로 개발해야 함
- 데이터베이스 스키마 업데이트는 먼저 진행해야 함 (Placement Test, 에너지 시스템, 재시도 기능에 필요)
