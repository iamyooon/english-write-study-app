# Cursor AI 개발 규칙

## 자동 테스트 실행 규칙

### 구현 완료 전 필수 사항
1. **코드 구현 후 반드시 테스트 실행**
   - 모든 코드 변경 후 `npm test` 실행
   - 테스트가 통과해야만 구현 완료로 간주
   - 테스트 실패 시 자동으로 수정 시도

2. **테스트 실행 순서**
   - 타입 체크: `npm run type-check`
   - 린트 체크: `npm run lint`
   - 단위 테스트: `npm test`
   - 관련 테스트 파일이 있으면 해당 테스트만 실행

3. **테스트 실패 시 처리**
   - 테스트 실패 원인 분석
   - 코드 수정 또는 테스트 업데이트
   - 최대 3회까지 재시도
   - 3회 실패 시 사용자에게 알림

### 테스트 커버리지
- 새로 추가된 기능은 최소한의 테스트 작성
- API 엔드포인트는 반드시 테스트 포함
- 컴포넌트는 주요 기능 테스트 포함

### 코드 품질
- 타입 에러 없음
- 린트 에러 없음
- 테스트 통과 필수

## 디버깅 및 로깅 규칙

### 콘솔 로그 필수 사항
1. **모든 주요 함수/메서드에 콘솔 로그 추가**
   - 함수 시작 시: `console.log('[태그] 함수명 시작:', { 파라미터 })`
   - 함수 완료 시: `console.log('[태그] 함수명 완료:', { 결과 })`
   - 오류 발생 시: `console.error('[태그] 함수명 오류:', { error, message, stack })`
   - 상태 변경 시: `console.log('[태그] 상태 변경:', { before, after })`

2. **로그 태그 규칙**
   - 파일/컴포넌트별로 고유한 태그 사용
   - 예: `[문장 생성]`, `[제출]`, `[API 제출]`, `[DragDrop]`, `[자동 생성]`
   - 태그는 대괄호 `[]`로 감싸고, 뒤에 동작 설명 추가
   - 예: `[문장 생성] 시작:`, `[제출] API 호출 시작`

3. **로그 레벨별 사용 규칙**
   - `console.log`: 일반 정보, 디버깅 정보, 상태 추적
   - `console.warn`: 경고 메시지, 예상 가능한 문제
   - `console.error`: 오류 발생 시 (반드시 error 객체와 함께)

4. **필수 로그 위치**
   - API 엔드포인트: 요청 받음, 검증, 처리 시작, 응답 전송
   - React 컴포넌트: 이벤트 핸들러 시작, 상태 변경, API 호출 전/후
   - 비동기 함수: Promise 시작, 성공, 실패
   - 조건 분기: 중요한 조건문 진입 시

5. **로그 내용 포함 사항**
   - 함수/메서드 이름
   - 입력 파라미터 (민감 정보 제외)
   - 상태 변경 전/후 값
   - 오류 발생 시: error 객체, message, stack
   - API 호출 시: 요청/응답 데이터 (민감 정보 제외)

6. **로그 예시**
   ```typescript
   // 좋은 예
   console.log('[문장 생성] 시작:', { isDragDropMode, gradeLevel, level, energy })
   console.log('[제출] API 응답 받음:', { queueStatus: data.queueStatus, hasFeedback: !!data.feedback })
   console.error('[제출] 오류 발생:', { error, message: error.message, stack: error.stack })
   
   // 나쁜 예
   console.log('시작')  // 태그 없음, 정보 부족
   console.log(data)     // 태그 없음, 구조화되지 않음
   ```

7. **프로덕션 고려사항**
   - 개발 환경에서만 상세 로그 출력 (환경 변수로 제어)
   - 프로덕션에서는 중요한 오류만 로깅
   - 민감한 정보(비밀번호, 토큰 등)는 절대 로그에 포함하지 않음

## Git 커밋 메시지 작성 규칙

### 한글 인코딩 문제 방지
1. **반드시 텍스트 파일을 사용하여 커밋**
   - PowerShell에서 직접 `git commit -m "한글 메시지"` 사용 금지
   - `commit-message.txt` 파일에 커밋 메시지 작성 후 `git commit -F commit-message.txt` 사용
   - 또는 `.\commit.ps1 "커밋 메시지"` 스크립트 사용

2. **커밋 메시지 작성 방법**
   ```powershell
   # 방법 1: 스크립트 사용 (권장)
   .\commit.ps1 "커밋 메시지 내용"
   
   # 방법 2: 텍스트 파일 직접 사용
   # commit-message.txt 파일에 메시지 작성 후
   git commit -F commit-message.txt
   ```

3. **커밋 메시지 수정 (amend)**
   ```powershell
   # 방법 1: 스크립트 사용 (권장)
   .\commit-amend.ps1 "새로운 커밋 메시지"
   
   # 방법 2: 텍스트 파일 직접 사용
   # commit-message.txt 파일에 메시지 작성 후
   git commit --amend -F commit-message.txt
   ```

4. **커밋 메시지 형식**
   - 첫 줄: 변경사항 요약 (50자 이내 권장)
   - 빈 줄
   - 상세 설명: 변경 이유, 주요 변경사항, 영향 범위 등
   - 각 항목은 `-` 또는 `*`로 시작하는 리스트 형식

5. **주의사항**
   - 커밋 메시지 파일은 UTF-8 인코딩으로 저장
   - `commit-message.txt`는 `.gitignore`에 포함되어 있으므로 커밋되지 않음
   - 커밋 전에 반드시 `git add`로 변경사항 스테이징 필요
