# 영어 문장 쓰기 앱 - 아키텍처 가이드

## 📋 목차
1. [프로젝트 전체 구조](#1-프로젝트-전체-구조)
2. [애플리케이션 계층 구조](#2-애플리케이션-계층-구조)
3. [데이터 흐름도](#3-데이터-흐름도)
4. [컴포넌트 상세 구조](#4-컴포넌트-상세-구조)
5. [서비스 레이어](#5-서비스-레이어)
6. [테스트 구조](#6-테스트-구조)
7. [빌드 및 배포](#7-빌드-및-배포)

---

## 1. 프로젝트 전체 구조

```
english-write-study-app/
│
├── 📁 src/                          # 소스 코드
│   ├── main.tsx                     # React 앱 진입점
│   ├── index.css                    # 전역 스타일
│   └── vite-env.d.ts                # Vite 타입 정의
│
├── 📁 components/                   # React 컴포넌트
│   ├── SentenceWritingPage.tsx      # 🎯 메인 컴포넌트
│   ├── SentenceWritingPage.test.tsx # 컴포넌트 유닛 테스트
│   ├── DiaryPage.tsx                # (레거시) 일기 쓰기 컴포넌트
│   └── DiaryPage.test.tsx           # (레거시) 테스트
│
├── 📁 services/                     # 비즈니스 로직 서비스
│   ├── SentenceService.ts           # 🎯 문장 생성/평가 서비스
│   ├── SentenceService.test.ts      # 서비스 유닛 테스트
│   └── GrammarService.ts            # (레거시) 문법 검사 서비스
│
├── 📁 utils/                        # 유틸리티 함수
│   └── diffUtils.ts                 # 문장 비교 유틸리티
│
├── 📁 e2e/                          # E2E 테스트 (Playwright)
│   ├── sentence-writing.spec.ts     # 🎯 메인 E2E 테스트
│   └── diary.spec.ts                # (레거시) E2E 테스트
│
├── 📁 scripts/                      # Node.js 스크립트
│   ├── log-to-jira.mjs              # Jira 로깅 스크립트
│   ├── jira-logger.js               # Jira API 헬퍼
│   ├── create-dev-task.js           # Jira 태스크 생성
│   ├── update-task.js               # Jira 태스크 업데이트
│   └── ...
│
├── 📁 icons/                        # 아이콘 리소스
│
├── 📄 index.html                    # HTML 진입점
├── 📄 package.json                  # 프로젝트 설정
├── 📄 vite.config.ts                # Vite 빌드 설정
├── 📄 vitest.config.ts              # Vitest 테스트 설정
├── 📄 playwright.config.ts          # Playwright 설정
├── 📄 tailwind.config.js            # Tailwind CSS 설정
└── 📄 vercel.json                   # Vercel 배포 설정
```

---

## 2. 애플리케이션 계층 구조

```
┌─────────────────────────────────────────────────────────────┐
│                        브라우저 (Browser)                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    index.html (진입점)                        │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  <div id="root"></div>                               │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    src/main.tsx                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  ReactDOM.createRoot()                               │  │
│  │    └─> <SentenceWritingPage />                      │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              components/SentenceWritingPage.tsx             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  UI 레이어 (Presentation Layer)                      │  │
│  │  - 사용자 입력 처리                                   │  │
│  │  - 상태 관리 (useState)                              │  │
│  │  - 이벤트 핸들러                                      │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              services/SentenceService.ts                     │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  비즈니스 로직 레이어 (Business Logic Layer)          │  │
│  │  - OpenAI API 통신                                    │  │
│  │  - 데이터 변환 및 검증                                │  │
│  │  - 에러 처리                                          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    OpenAI API (외부 서비스)                   │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  GPT-4 API                                           │  │
│  │  - 한글 문장 생성                                     │  │
│  │  - 영어 문장 평가                                     │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 데이터 흐름도

### 3.1 한글 문장 생성 흐름

```
사용자 액션: "초등학교" 레벨 선택 후 "문장 생성" 클릭
    │
    ▼
┌─────────────────────────────────────────┐
│  SentenceWritingPage                    │
│  ┌───────────────────────────────────┐  │
│  │  handleGenerateSentence()        │  │
│  │  - setLevel('elementary')        │  │
│  │  - setIsGenerating(true)        │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    │ level: 'elementary'
    ▼
┌─────────────────────────────────────────┐
│  SentenceService                        │
│  ┌───────────────────────────────────┐  │
│  │  generateKoreanSentence(level)    │  │
│  │  - API 키 검증                     │  │
│  │  - 프롬프트 생성                   │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    │ HTTP POST Request
    │ {
    │   model: "gpt-4",
    │   messages: [...]
    │ }
    ▼
┌─────────────────────────────────────────┐
│  OpenAI API                             │
│  ┌───────────────────────────────────┐  │
│  │  GPT-4 응답 생성                   │  │
│  │  - 한글 문장 생성                   │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    │ HTTP Response
    │ {
    │   choices: [{
    │     message: {
    │       content: "나는 사과를 좋아해요"
    │     }
    │   }]
    │ }
    ▼
┌─────────────────────────────────────────┐
│  SentenceService                        │
│  ┌───────────────────────────────────┐  │
│  │  JSON 파싱 및 검증                 │  │
│  │  return {                          │  │
│  │    koreanSentence: "나는...",     │  │
│  │    level: "elementary"            │  │
│  │  }                                 │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    │ result: SentenceGenerationResult
    ▼
┌─────────────────────────────────────────┐
│  SentenceWritingPage                    │
│  ┌───────────────────────────────────┐  │
│  │  setKoreanSentence(result)        │  │
│  │  setIsGenerating(false)           │  │
│  │  - UI 업데이트                     │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    ▼
사용자 화면: "나는 사과를 좋아해요" 표시
```

### 3.2 영어 문장 평가 흐름

```
사용자 액션: 영어 문장 입력 후 "평가하기" 클릭
    │
    │ userEnglish: "I like apple"
    │ koreanSentence: "나는 사과를 좋아해요"
    │ level: "elementary"
    ▼
┌─────────────────────────────────────────┐
│  SentenceWritingPage                    │
│  ┌───────────────────────────────────┐  │
│  │  handleEvaluate()                 │  │
│  │  - 입력 검증                       │  │
│  │  - setIsLoading(true)             │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    │ userEnglish, koreanSentence, level
    ▼
┌─────────────────────────────────────────┐
│  SentenceService                        │
│  ┌───────────────────────────────────┐  │
│  │  evaluateEnglishSentence(...)     │  │
│  │  - 프롬프트 생성                   │  │
│  │  - JSON 형식 요청                  │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    │ HTTP POST Request
    │ {
    │   model: "gpt-4",
    │   response_format: { type: "json_object" },
    │   messages: [...]
    │ }
    ▼
┌─────────────────────────────────────────┐
│  OpenAI API                             │
│  ┌───────────────────────────────────┐  │
│  │  GPT-4 평가 및 피드백 생성         │  │
│  │  - 점수 계산                       │  │
│  │  - 오류 분석                       │  │
│  │  - 올바른 문장 제안                │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    │ HTTP Response (JSON)
    │ {
    │   correctEnglish: "I like apples",
    │   score: 85,
    │   feedback: "...",
    │   errors: [...]
    │ }
    ▼
┌─────────────────────────────────────────┐
│  SentenceService                        │
│  ┌───────────────────────────────────┐  │
│  │  JSON 파싱 및 검증                 │  │
│  │  return SentenceEvaluationResult  │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    │ evaluationResult
    ▼
┌─────────────────────────────────────────┐
│  SentenceWritingPage                    │
│  ┌───────────────────────────────────┐  │
│  │  setEvaluationResult(result)      │  │
│  │  - diffUtils.computeSentenceDiff()│  │
│  │  - UI 업데이트                     │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
    │
    ▼
사용자 화면: 점수, 피드백, 오류 목록 표시
```

---

## 4. 컴포넌트 상세 구조

### 4.1 SentenceWritingPage 컴포넌트 구조

```
┌─────────────────────────────────────────────────────────────┐
│              SentenceWritingPage Component                   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  State (useState)                                    │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  • level: 'elementary' | 'middle' | 'high'          │  │
│  │  • koreanSentence: string                           │  │
│  │  • userEnglish: string                              │  │
│  │  • evaluationResult: SentenceEvaluationResult | null│  │
│  │  • isLoading: boolean                               │  │
│  │  • isGenerating: boolean                            │  │
│  │  • error: string | null                             │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Event Handlers                                       │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  • handleGenerateSentence()                          │  │
│  │    └─> SentenceService.generateKoreanSentence()     │  │
│  │                                                       │  │
│  │  • handleEvaluate()                                  │  │
│  │    └─> SentenceService.evaluateEnglishSentence()    │  │
│  │                                                       │  │
│  │  • handleLevelChange()                               │  │
│  │    └─> setLevel()                                    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  UI Render                                            │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  ┌──────────────────────────────────────────────┐   │  │
│  │  │  레벨 선택 (Radio Buttons)                    │   │  │
│  │  │  ○ 초등학교  ○ 중학교  ○ 고등학교            │   │  │
│  │  └──────────────────────────────────────────────┘   │  │
│  │                                                       │  │
│  │  ┌──────────────────────────────────────────────┐   │  │
│  │  │  [문장 생성] 버튼                             │   │  │
│  │  └──────────────────────────────────────────────┘   │  │
│  │                                                       │  │
│  │  ┌──────────────────────────────────────────────┐   │  │
│  │  │  한글 문장 표시 영역                          │   │  │
│  │  │  "나는 사과를 좋아해요"                       │   │  │
│  │  └──────────────────────────────────────────────┘   │  │
│  │                                                       │  │
│  │  ┌──────────────────────────────────────────────┐   │  │
│  │  │  영어 입력 영역 (Textarea)                    │   │  │
│  │  │  "I like apple"                               │   │  │
│  │  └──────────────────────────────────────────────┘   │  │
│  │                                                       │  │
│  │  ┌──────────────────────────────────────────────┐   │  │
│  │  │  [평가하기] 버튼                              │   │  │
│  │  └──────────────────────────────────────────────┘   │  │
│  │                                                       │  │
│  │  ┌──────────────────────────────────────────────┐   │  │
│  │  │  평가 결과 표시 영역                          │   │  │
│  │  │  • 점수: 85/100                              │   │  │
│  │  │  • 올바른 문장: "I like apples"              │   │  │
│  │  │  • 피드백: "..."                             │   │  │
│  │  │  • 오류 목록: [...]                          │   │  │
│  │  └──────────────────────────────────────────────┘   │  │
│  │                                                       │  │
│  │  ┌──────────────────────────────────────────────┐   │  │
│  │  │  에러 메시지 (role="alert")                   │   │  │
│  │  └──────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 컴포넌트 의존성 관계

```
┌─────────────────────┐
│   index.html        │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│   src/main.tsx      │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────────────────────┐
│  SentenceWritingPage.tsx             │
│  ┌───────────────────────────────┐  │
│  │  imports:                    │  │
│  │  • SentenceService           │  │
│  │  • diffUtils                 │  │
│  └───────────────────────────────┘  │
└──────────┬──────────────────────────┘
           │
           ├─────────────────┐
           │                 │
           ▼                 ▼
┌─────────────────────┐  ┌─────────────────────┐
│  SentenceService    │  │  diffUtils           │
│  └──────────────────┘  └─────────────────────┘
           │
           ▼
┌─────────────────────┐
│  OpenAI API         │
└─────────────────────┘
```

---

## 5. 서비스 레이어

### 5.1 SentenceService 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    SentenceService                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Types & Interfaces                                  │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  • Level: 'elementary' | 'middle' | 'high'          │  │
│  │  • SentenceGenerationResult                          │  │
│  │  • SentenceEvaluationResult                         │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  generateKoreanSentence(level: Level)               │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  1. API 키 검증                                       │  │
│  │  2. 레벨별 프롬프트 생성                              │  │
│  │  3. OpenAI API 호출                                  │  │
│  │  4. 응답 파싱 및 검증                                 │  │
│  │  5. SentenceGenerationResult 반환                    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  evaluateEnglishSentence(                            │  │
│  │    koreanSentence: string,                           │  │
│  │    userEnglish: string,                              │  │
│  │    level: Level                                      │  │
│  │  )                                                   │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  1. API 키 검증                                       │  │
│  │  2. 평가 프롬프트 생성                                │  │
│  │  3. OpenAI API 호출 (JSON 형식)                      │  │
│  │  4. JSON 응답 파싱 및 검증                            │  │
│  │  5. SentenceEvaluationResult 반환                    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Private Helper Methods                              │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  • _buildGenerationPrompt(level)                     │  │
│  │  • _buildEvaluationPrompt(...)                       │  │
│  │  • _validateAPIResponse(data)                        │  │
│  │  • _handleAPIError(response)                         │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 OpenAI API 통신 구조

```
┌─────────────────────────────────────────────────────────────┐
│              OpenAI API 통신 흐름                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Request Format:                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  POST https://api.openai.com/v1/chat/completions    │  │
│  │  Headers:                                            │  │
│  │    Authorization: Bearer {VITE_OPENAI_API_KEY}      │  │
│  │    Content-Type: application/json                   │  │
│  │  Body:                                               │  │
│  │    {                                                 │  │
│  │      model: "gpt-4",                                 │  │
│  │      messages: [                                     │  │
│  │        { role: "system", content: "..." },          │  │
│  │        { role: "user", content: "..." }             │  │
│  │      ],                                              │  │
│  │      response_format: { type: "json_object" }       │  │
│  │    }                                                 │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  Response Format:                                            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  {                                                   │  │
│  │    choices: [                                        │  │
│  │      {                                               │  │
│  │        message: {                                    │  │
│  │          content: "{...JSON...}"                    │  │
│  │        }                                             │  │
│  │      }                                               │  │
│  │    ]                                                 │  │
│  │  }                                                   │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. 테스트 구조

### 6.1 테스트 계층 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    테스트 피라미드                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│                          ┌──────┐                           │
│                          │ E2E  │  ← Playwright             │
│                          │      │     (e2e/*.spec.ts)       │
│                          └──────┘                           │
│                         ╱        ╲                          │
│                        ╱          ╲                         │
│                   ┌──────┐      ┌──────┐                    │
│                   │통합  │      │통합  │                    │
│                   │테스트│      │테스트│                    │
│                   └──────┘      └──────┘                    │
│                  ╱        ╲      ╱        ╲                 │
│                 ╱          ╲    ╱          ╲                │
│            ┌──────┐    ┌──────┐    ┌──────┐                │
│            │유닛  │    │유닛  │    │유닛  │                │
│            │테스트│    │테스트│    │테스트│                │
│            └──────┘    └──────┘    └──────┘                │
│                                                              │
│  • SentenceService.test.ts      (서비스 로직)               │
│  • SentenceWritingPage.test.tsx (컴포넌트)                  │
│  • sentence-writing.spec.ts    (E2E)                       │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 테스트 파일 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    테스트 파일 맵                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  services/                                                   │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  SentenceService.test.ts                             │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  ✓ generateKoreanSentence()                          │  │
│  │    - API 키 검증 테스트                               │  │
│  │    - 레벨별 문장 생성 테스트                          │  │
│  │    - 에러 처리 테스트                                 │  │
│  │                                                       │  │
│  │  ✓ evaluateEnglishSentence()                         │  │
│  │    - 성공적인 평가 테스트                             │  │
│  │    - JSON 파싱 테스트                                 │  │
│  │    - 에러 처리 테스트                                 │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  components/                                                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  SentenceWritingPage.test.tsx                         │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  ✓ 초기 렌더링 테스트                                 │  │
│  │  ✓ 레벨 선택 테스트                                   │  │
│  │  ✓ 문장 생성 플로우 테스트                            │  │
│  │  ✓ 문장 평가 플로우 테스트                            │  │
│  │  ✓ 에러 메시지 표시 테스트                            │  │
│  │  ✓ 로딩 상태 테스트                                   │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  e2e/                                                        │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  sentence-writing.spec.ts                           │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  ✓ 전체 사용자 플로우 테스트                          │  │
│  │    - 레벨 선택                                        │  │
│  │    - 문장 생성                                        │  │
│  │    - 영어 입력                                        │  │
│  │    - 평가 결과 확인                                   │  │
│  │                                                       │  │
│  │  ✓ 에러 시나리오 테스트                               │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 6.3 테스트 실행 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                    테스트 실행 파이프라인                     │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  npm test                                                    │
│    │                                                         │
│    ├─> Vitest 실행                                          │
│    │     │                                                   │
│    │     ├─> SentenceService.test.ts                       │
│    │     │     └─> Mock fetch API                           │
│    │     │                                                   │
│    │     └─> SentenceWritingPage.test.tsx                  │
│    │           └─> Mock SentenceService                     │
│    │                                                         │
│    └─> npm run test:e2e                                     │
│          │                                                   │
│          └─> Playwright 실행                                │
│                │                                             │
│                └─> sentence-writing.spec.ts                 │
│                      └─> 실제 브라우저 테스트                │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 7. 빌드 및 배포

### 7.1 빌드 프로세스

```
┌─────────────────────────────────────────────────────────────┐
│                    빌드 파이프라인                           │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  npm run build                                               │
│    │                                                         │
│    ├─> TypeScript 컴파일 (tsc)                              │
│    │     └─> 타입 체크 및 .ts → .js 변환                   │
│    │                                                         │
│    └─> Vite 빌드                                             │
│          │                                                   │
│          ├─> React 컴포넌트 번들링                          │
│          ├─> CSS 처리 (Tailwind)                            │
│          ├─> 코드 최적화 (minify)                           │
│          └─> dist/ 폴더에 산출물 생성                       │
│                                                              │
│  dist/                                                       │
│  ├── index.html                                             │
│  ├── assets/                                                │
│  │   ├── index-[hash].js                                   │
│  │   └── index-[hash].css                                  │
│  └── vite.svg                                               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 배포 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    배포 아키텍처                             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐                                           │
│  │  GitHub      │                                           │
│  │  Repository  │                                           │
│  └──────┬───────┘                                           │
│         │                                                    │
│         │ git push                                           │
│         ▼                                                    │
│  ┌──────────────┐                                           │
│  │  Vercel      │                                           │
│  │  (CI/CD)     │                                           │
│  └──────┬───────┘                                           │
│         │                                                    │
│         ├─> 환경 변수 주입                                   │
│         │     • VITE_OPENAI_API_KEY                         │
│         │                                                    │
│         ├─> npm install                                      │
│         ├─> npm run build                                    │
│         └─> 배포                                             │
│               │                                               │
│               ▼                                               │
│  ┌──────────────────────────────┐                           │
│  │  Production                  │                           │
│  │  https://...vercel.app      │                           │
│  └──────────────────────────────┘                           │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 7.3 환경 변수 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    환경 변수 관리                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  로컬 개발 (.env - gitignore)                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  VITE_OPENAI_API_KEY=sk-...                         │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  Vercel 환경 변수                                            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  VITE_OPENAI_API_KEY                                 │  │
│  │  (Vercel 대시보드에서 설정)                           │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  코드에서 사용                                               │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  import.meta.env.VITE_OPENAI_API_KEY                  │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 8. 주요 기술 스택

```
┌─────────────────────────────────────────────────────────────┐
│                    기술 스택 맵                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Frontend                                                     │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  • React 18          - UI 라이브러리                │  │
│  │  • TypeScript        - 타입 안정성                  │  │
│  │  • Vite              - 빌드 도구                    │  │
│  │  • Tailwind CSS      - 스타일링                     │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  Testing                                                      │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  • Vitest             - 유닛 테스트                  │  │
│  │  • @testing-library   - React 테스트 유틸            │  │
│  │  • Playwright         - E2E 테스트                   │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  External APIs                                               │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  • OpenAI GPT-4      - AI 문장 생성/평가             │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  Deployment                                                  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  • Vercel             - 호스팅 및 CI/CD              │  │
│  │  • GitHub             - 소스 코드 관리                │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 9. 에러 처리 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                    에러 처리 계층                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  OpenAI API 에러                                             │
│    │                                                         │
│    ▼                                                         │
│  SentenceService                                             │
│    │  • API 응답 파싱                                        │
│    │  • 에러 메시지 추출                                     │
│    │  • Error 객체로 변환                                    │
│    ▼                                                         │
│  SentenceWritingPage                                         │
│    │  • catch 블록에서 에러 처리                             │
│    │  • 에러 메시지 추출                                     │
│    │  • setError() 호출                                      │
│    ▼                                                         │
│  UI 렌더링                                                   │
│    │  • role="alert" 에러 메시지 표시                       │
│    │  • 사용자에게 친화적인 메시지                          │
│    ▼                                                         │
│  사용자                                                      │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 10. 파일 크기 및 의존성

```
┌─────────────────────────────────────────────────────────────┐
│                    프로젝트 메트릭                           │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  주요 파일 크기 (라인 수)                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  SentenceWritingPage.tsx      ~300 lines             │  │
│  │  SentenceService.ts           ~240 lines             │  │
│  │  SentenceWritingPage.test.tsx ~200 lines             │  │
│  │  SentenceService.test.ts      ~150 lines             │  │
│  │  sentence-writing.spec.ts    ~100 lines             │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  테스트 커버리지                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  • SentenceService:     100%                         │  │
│  │  • SentenceWritingPage: 주요 기능 커버               │  │
│  │  • E2E:                 주요 플로우 커버             │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 11. API 엔드포인트 (Next.js App Router)

**업데이트**: 2026-01-18 - 에너지 시스템 API 추가

### 11.1 미션 생성 API

**엔드포인트**: `POST /api/study/generate-mission`

**기능**: 수준에 맞는 한글 문장, 어휘 목록, 예시 문장을 생성합니다.

**요청 형식**:
```json
{
  "gradeLevel": "elementary_low" | "elementary_high",
  "level": 1-10
}
```

**응답 형식**:
```json
{
  "success": true,
  "mission": {
    "korean": "나는 사과를 좋아해요",
    "vocabulary": ["I", "like", "apple"],
    "example": "I like apples.",
    "gradeLevel": "elementary_low",
    "level": 1
  }
}
```

**주요 변경사항 (2026-01-17)**:
- `vocabulary` 필드 추가: 한글 문장을 영어로 번역할 때 필요한 주요 단어 3-5개
- `example` 필드 추가: 한글 문장을 영어로 번역한 예시 문장
- OpenAI API 프롬프트 개선: 어휘와 예시를 함께 생성하도록 확장
- `max_tokens` 증가: 100 → 300 (어휘와 예시 포함)

**테스트**: `app/api/study/generate-mission/route.test.ts` (4개 테스트 통과)

### 11.2 에너지 시스템 API

**엔드포인트**: `POST /api/energy/charge-daily`

**기능**: 자정 이후에 실행하여 에너지가 부족한 사용자들의 에너지를 100으로 충전합니다.

**요청 형식**: 인증 필요 (GET 또는 POST)

**응답 형식**:
```json
{
  "success": true,
  "message": "에너지 충전 완료: 5명 성공, 0명 실패",
  "chargedCount": 5,
  "failedCount": 0,
  "totalUsers": 5
}
```

**주요 기능**:
- `getUsersNeedingEnergyCharge()`: 오늘 자정 이후로 충전하지 않은 사용자 찾기
- `chargeEnergyDaily(userId)`: 각 사용자의 에너지를 100으로 충전, `energy_last_charged` 업데이트

**사용 방법**:
- Supabase Edge Function 또는 Cron Job에서 주기적으로 호출 (예: 매일 자정)
- 개발 환경에서는 수동으로 `GET /api/energy/charge-daily` 호출 가능

**테스트**: `lib/supabase/utils.test.ts` (6개 테스트 통과)

### 11.3 Writing 제출 API - 에너지 시스템 통합

**엔드포인트**: `POST /api/study/submit`

**에너지 관련 변경사항 (2026-01-18)**:
- **에너지 소비**: 미션 시작 시 에너지 100 소비 (부족 시 403 에러 반환)
- **에너지 생산**: 미션 완료 시 에너지 +10 생산 (최대 100)
- **응답 필드**: `energyGained` 필드 추가 (이번 미션에서 획득한 에너지)

**에너지 부족 시 응답**:
```json
{
  "error": "에너지가 부족합니다. 내일 에너지가 충전되면 다시 시도해주세요.",
  "energyRequired": 100,
  "currentEnergy": 50
}
```

**정상 응답 (에너지 관련 필드 추가)**:
```json
{
  "success": true,
  "studyLog": {...},
  "feedback": {...},
  "energyGained": 10
}
```

### 11.4 Writing 페이지 UI 구조

**파일**: `app/writing/page.tsx`

**주요 기능**:
1. 미션 제시: 한글 문장 표시
2. **어휘 노출**: 주요 단어를 노란색 배지 형태로 표시 (새로 추가)
3. **예시 문장**: 보라색 박스 형태로 영어 예시 문장 표시 (새로 추가)
4. 작성: 영어 입력 필드
5. LLM 피드백: AI 평가 결과 표시

**UI 컴포넌트 구조**:
```
WritingPage
├── 한글 문장 (기존)
├── 어휘 노출 (새로 추가)
│   └── vocabulary.map() → 노란색 배지
├── 예시 문장 (새로 추가)
│   └── 보라색 박스 + 참고 메시지
├── 영어 입력 (기존)
└── 피드백 표시 (기존)
```

**Mission 타입 확장**:
```typescript
interface Mission {
  korean: string
  vocabulary?: string[]  // 새로 추가
  example?: string       // 새로 추가
  gradeLevel: 'elementary_low' | 'elementary_high'
  level: number
}
```

---

## 📝 참고사항

### 주요 디렉토리 설명
- **app/**: Next.js App Router 페이지 및 API 라우트
- **components/**: React UI 컴포넌트 (레거시)
- **services/**: 비즈니스 로직 및 API 통신 (레거시)
- **utils/**: 재사용 가능한 유틸리티 함수
- **e2e/**: End-to-End 테스트 (Playwright)
- **scripts/**: Node.js 유틸리티 스크립트 (Jira 통합 등)

### 레거시 코드
- `DiaryPage.tsx`: 이전 "영어 일기 쓰기" 기능 (현재 미사용)
- `GrammarService.ts`: 이전 문법 검사 서비스 (현재 미사용)

### 환경 변수
- `VITE_OPENAI_API_KEY`: OpenAI API 키 (필수)

### 실행 명령어
- `npm run dev`: 개발 서버 실행
- `npm run build`: 프로덕션 빌드
- `npm test`: 유닛 테스트 실행
- `npm run test:e2e`: E2E 테스트 실행

---

**문서 버전**: 1.0  
**최종 업데이트**: 2024년  
**작성자**: AI Assistant

